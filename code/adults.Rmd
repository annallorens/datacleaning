---
title: 'PRÁCTICA 2: Limpieza y validación de los datos'
author: "Autores: Anna Llorens Roig, Carlos Villar Robles"
date: "Dataset: Adults"
output:
  pdf_document:
    highlight: zenburn
    toc: yes
  html_document:
    highlight: default
    theme: cosmo
    toc: yes
    toc_depth: 3
  word_document: default
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\pagebreak

## 1. Introducción

  El conjunto de datos objeto de análisis es de la base de datos 'Adult' del Censo de 1994 en Estados Unidos. Los detalles de este conjunto de datos se pueden encontrar en el repositorio de UCI Machine Learning: [https://archive.ics.uci.edu/ml/datasets/Adult](https://archive.ics.uci.edu/ml/datasets/Adult). 

  Durante el desarrollo de esta práctica  trataremos de construir un modelo para predecir si el ingreso de cualquier individuo en los Estados Unidos es mayor o menor que USD 50000 según la información disponible sobre ese individuo en los datos del censo. Nos interesa conocer qué tan bien se puede predecir si el ingreso anual de una persona supera los 50000$ utilizando el conjunto de variables en este conjunto de datos. La pregunta se inspecciona en dos enfoques: técnicas de aprendizaje automático, visualización de datos y modelado estadístico tradicional. \linebreak \linebreak 
  
## 2. Descripción del dataset
  
  Se trata del 'Adult data set' el cual consta de 15 atributos y 32561 observaciones. \linebreak 
  Entre los campos del conjunto de datos encontramos las siguientes variables dependientes:

- _**age**_: edad del individuo
- _**type_employer**_: tipo de empleador que tiene el individuo. Ya sean gubernamentales, militares, privados, etc.
- _**fnlwgt**_: El \ # de personas que los encuestados creen que representa la observación. Ignoraremos esta variable
- _**education**_: nivel más alto de educación alcanzado para esa persona
- _**education_num**_: nivel más alto de educación en forma numérica
- _**marital**_: estado civil del individuo
- _**occupation**_:  ocupación del individuo
- _**relationship**_: contiene valores de relaciones familiares como marido, padre, etc., pero solo contiene uno por observación
- _**race**_: descripciones de la raza individual. Negro, blanco, esquimal, 
- _**sex**_: sexo del individuo
- _**capital_gain**_: ganancias de capital registradas
- _**capital_loss**_: pérdidas de capital registradas
- _**hr_per_week**_: horas trabajadas por semana
- _**country**_: país de origen del individuo 

Cómo variable dependiente del dataset tenemos:

- _**income**_: variable booleana. Representa si la persona gana o no más de \ $ 50,000 por año de ingresos. \linebreak \linebreak 


## 3. Inegración y selección de los datos de interés. 

Antes de comenzar con la limpieza de los datos, procedemos a realizar la lectura del fichero en formato CSV en el que se encuentran. El resultado devuelto por la llamada a la función read.csv() será un objeto data.frame el cual mostraremos su cabecera: 

```{r}
# Lectura de datos
data <-read.csv('../data/adults.csv', header = TRUE)
```

```{r , include=FALSE}
#Eliminamos la primera columna ya que se trata de un índice.
data$X <- NULL

# Factorizamos variable sexo
data$sex <- gsub('Female', 'F', data$sex)
data$sex <- gsub('Male', 'M', data$sex)
data$sex <- as.factor(data$sex)

```

```{r}
# Comprobamos que los datos se han importado correctamente
head(data[,1:5])
```


Un resumen de alto nivel de los datos se encuentra a continuación. Todas las variables han sido leídas en sus clases esperadas. 
  
```{r}
str(data)
```
 
En primer lugar seleccionaremos las variables que las que nos centraremos para realizar el análisis. Por lo que eliminaremos las variables  _education_, _fnlwgt_, _relationship_, _capital-gain_, _capital-gain_, _race_

```{r}
# Eliminamos variables
data$education <- NULL
data$fnlwgt <- NULL
data$relationship <- NULL
data$capital_gain <- NULL
data$capital_loss <- NULL
data$native_country <- NULL
data$race <- NULL
```


## 4. Limpieza de los datos.

Una vez tenemos el conjunto de datos con el que trabajaremos observamos el resumen del conjuto y pasaremos a la limpieza de estos. 

```{r}
summary(data)
```

### 4.1 Ceros y elementos vacios 
Tal y como se indica en la descripción del dataset se utiliza el carácter '?' para denotar un valor desconocido. Así, se procede a conocer a continuación qué campos contienen elementos vacíos:

```{r}
# Números de valores desconocidos por campo
colSums(data=="?")
```
 
Llegados a este punto debemos decidir cómo manejar estos registros que contienen valores desconocidos para algún campo. Al disponer de un conjunto de datos relativamente grande (más de 32000 observaciones) procederemos a eliminar las columnas con registros nulos. 
```{r}
data<-data[!(data$workclass=="?"),]
data<-data[!(data$occupation=="?"),]
```

```{r}
# Comprobamos valores nulos
colSums(data=="?")
```


### 4.2 Identificación y tratamiento de valores extremos
## 5. Análisis de los datos.
### 5.1 Selección de los grupos de datos que se quieren analizar
Para simplificar el conjunto de valores de las variables categóricas vamos agrupar por categorias los siguientes atributos: _workclass_ , _maritalStatus_, _occupation_ 



- Para la variable __workclass__ deferenciaremos entre: goverment, public, public, self-employed, other
```{r}
# Observamos atributos originales para la variable workclass
summary(data$workclass)
```

```{r}
levels(data$workclass)[1] <- 'Unknown'
# combine into Government job
data$workclass <- gsub('^Federal-gov', 'Government', data$workclass)
data$workclass <- gsub('^Local-gov', 'Government', data$workclass)
data$workclass <- gsub('^State-gov', 'Government', data$workclass) 
data$workclass <- gsub('^Government', 'Public', data$workclass) 
# combine into Sele-Employed job
data$workclass <- gsub('^Self-emp-inc', 'Self-Employed', data$workclass)
data$workclass <- gsub('^Self-emp-not-inc', 'Self-Employed', data$workclass)

# combine into Other/Unknown
data$workclass <- gsub('^Never-worked', 'Other', data$workclass)
data$workclass <- gsub('^Without-pay', 'Other', data$workclass)
data$workclass <- gsub('^Other', 'Other', data$workclass)
data$workclass <- gsub('^Unknown', 'Other', data$workclass)
data$workclass <- as.factor(data$workclass)
```

```{r}
# Observamos nuevos atributos para la variable workclass
summary(data$workclass)
```

- Para la variable __maritalStatus__ deferenciaremos entre: married, single
```{r}
# Observamos atributos originales para la variable maritalStatus
summary(data$maritalStatus)
```

```{r}
data$maritalStatus <- gsub('Married-AF-spouse', 'Married', data$maritalStatus)
data$maritalStatus <- gsub('Married-civ-spouse', 'Married', data$maritalStatus)
data$maritalStatus <- gsub('Married-spouse-absent', 'Married', data$maritalStatus)
data$maritalStatus <- gsub('Never-married', 'Single', data$maritalStatus)
data$maritalStatus <- gsub('Widowed', 'Single', data$maritalStatus)
data$maritalStatus <- gsub('Divorced', 'Single', data$maritalStatus)
data$maritalStatus <- gsub('Separated', 'Single', data$maritalStatus)
data$maritalStatus <- as.factor(data$maritalStatus)
```

```{r}
# Observamos nuevos atributos para la variable maritalStatus
summary(data$maritalStatus)
```

- Para la variable __occupation__ deferenciaremos entre: Adm-clerical, Blue-Collar, Other/Unknown, Professional, Sales, Service, White-Collar
```{r}
# Observamos atributos originales para la variable occupation
summary(data$occupation)
```

```{r}
levels(data$occupation)[1] <- 'Unknown'
data$occupation <- gsub('Craft-repair', 'Blue-Collar', data$occupation)
data$occupation <- gsub('Exec-managerial', 'White-Collar', data$occupation)
data$occupation <- gsub('Farming-fishing', 'Blue-Collar', data$occupation)
data$occupation <- gsub('Handlers-cleaners', 'Blue-Collar', data$occupation)
data$occupation <- gsub('Machine-op-inspct', 'Blue-Collar', data$occupation)
data$occupation <- gsub('Other-service', 'Service', data$occupation)
data$occupation <- gsub('Priv-house-serv', 'Service', data$occupation)
data$occupation <- gsub('Prof-specialty', 'Professional', data$occupation)
data$occupation <- gsub('Protective-serv', 'Service', data$occupation)
data$occupation <- gsub('Tech-support', 'Service', data$occupation)
data$occupation <- gsub('Transport-moving', 'Blue-Collar', data$occupation)
data$occupation <- gsub('Unknown', 'Other/Unknown', data$occupation)
data$occupation <- gsub('Armed-Forces', 'Other/Unknown', data$occupation)
data$occupation <- as.factor(data$occupation)
```

```{r}
# Observamos nuevos atributos para la variable occupation
summary(data$occupation)
```

```{r}
# Observamos el conjunto de datos una vez han sido procesados
head(data)
```

## 6. Representación de los resultados a partir de tablas y gráficas
## 7. Resolución del problema. 
## 8. Contribuciones

| Contribuciones              | Firma         |
| --------------------------- | -------------:|
| Investigación previa        | AL, CV        |
| Introducción                | AL, CV        | 
| Descripción                 | AL, CV        |
| Integración                 | AL, CV        |
| Limpieza de datos           | AL, CV        |
| Desarrollo código           | ...........   |


